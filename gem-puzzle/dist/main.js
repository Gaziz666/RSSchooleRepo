(()=>{"use strict";function e(e,t,n,o,...r){let s=null;try{s=document.createElement(e)}catch(e){throw new Error("unable to create  HTMLElement! Give a proper tag name")}return t&&s.classList.add(...t.split(" ")),n&&Array.isArray(n)?n.forEach((e=>e&&s.appendChild(e))):n&&"object"==typeof n?s.appendChild(n):n&&"string"==typeof n&&(s.innerHTML=n),o&&o.appendChild(s),r.length&&r.forEach((([e,t])=>{""===t?s.setAttribute(t,""):e.match(/value|id|placeholder|cols|rows|autocorrect|spellcheck|src/)?s.setAttribute(e,t):s.dataset[e]=t})),s}class t{constructor({number:t}){this.number=t,this.chip=e("div","chip",String(t),null,["key",t])}}function n(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function o(e){return JSON.parse(window.localStorage.getItem(e))}function r(t){const r=t.target.closest(".chip"),s=r.cloneNode(!0),i=t.clientX-r.getBoundingClientRect().left,c=t.clientY-r.getBoundingClientRect().top,u=document.querySelector(".empty"),a=document.querySelector(".audio"),l=document.querySelectorAll(".chip"),d=document.querySelector(".game-container");let m=null,p=null,h=!1;var y,v;function g(e){!function(e,t){s.style.left=e-s.offsetWidth/2+"px",s.style.top=t-s.offsetHeight/2+"px"}(e.pageX,e.pageY),h=!0,s.classList.add("nonvisible");const t=document.elementFromPoint(e.clientX,e.clientY);s.classList.remove("nonvisible"),t&&(m=t.closest(".empty"))}"no"===o("mute")&&a.play(),t.target.closest(".empty")||(document.body.append(s),r.style.opacity=0,p=r,s.classList.add("dragging"),s.ondragstart=()=>!1,y=t.pageX,v=t.pageY,s.style.left=y-i+"px",s.style.top=v-c+"px",document.addEventListener("mousemove",g),s.onmouseup=()=>{if(document.removeEventListener("mousemove",g),h){if(!m||1!==Math.abs(p.style.order-m.style.order)&&4!==Math.abs(p.style.order-m.style.order))p.style.opacity=1,s.remove();else{const e=p.style.order,t=m.style.order;n("countMovie",Number(o("countMovie"))+1),document.querySelector(".counter").innerHTML=o("countMovie"),p.style.order=t,m.style.order=e,p.style.opacity=1,s.remove()}s.onmouseup=null,h=!1}else if(1===Math.abs(p.style.order-u.style.order)||4===Math.abs(p.style.order-u.style.order)){const e=p.style.order,t=u.style.order;p.style.order=t,u.style.order=e,n("countMovie",Number(o("countMovie"))+1),document.querySelector(".counter").innerHTML=o("countMovie"),p.style.opacity=1,s.remove()}else p.style.opacity=1,s.remove();let t=0;if(l.forEach((e=>{Number(e.dataset.key)===Number(e.style.order)+1&&(t+=1)})),15===t){const t=e("div","winner",`«Ура! Вы решили головоломку за \n      ${document.querySelector(".min").innerHTML}:${document.querySelector(".sec").innerHTML} и ${o("countMovie")} ходов»`);d.append(t);const r={min:document.querySelector(".min").innerHTML,sec:document.querySelector(".sec").innerHTML,count:o("countMovie")},s=o("winner");s.length<10?(s.push(r),n("winner",s)):(s.sort(((e,t)=>e.count-t.count)),s[s.length-1].count>r.count&&(s.pop(),s.push(r),n("winner",s)))}})}const s={type:[{number:0},{number:1},{number:2},{number:3},{number:4},{number:5},{number:6},{number:7},{number:8},{number:9},{number:10},{number:11},{number:12},{number:13},{number:14},{number:15}]};function i(){if("yes"===o("isPause"))return;const t=e("ul","menu",[e("li","list",'<span class="pause-buttons">Resume game</span>',null,["game","resume"]),e("li","list",'<span class="pause-buttons">Restart game</span>',null,["game","restart"]),e("li","list",'<span class="pause-buttons">New game</span>',null,["game","new"]),e("li","list",'<span class="pause-buttons">Save game</span>',null,["game","save"]),e("li","list",'<span class="pause-buttons">Load game</span>',null,["game","saved"]),e("li","list",'<span class="pause-buttons">Best score</span>',null,["game","score"])]),r="no"===o("mute")?e("i","material-icons","volume_up"):e("i","material-icons","volume_off"),i=e("div","popup",[t,r]);document.querySelector(".game-container").append(i),n("isPause","yes"),document.querySelector(".winner")&&document.querySelector(".winner").remove();const c=t=>{const r=t.target.closest(".list").dataset.game,c=document.querySelectorAll(".chip"),u=document.querySelector(".counter"),a=o("chipOrder"),l=document.querySelector(".sec"),d=document.querySelector(".min"),m=[],h={};"resume"===r?(i.remove(),n("isPause","no")):"restart"===r?(c.forEach((e=>{const t=a.indexOf(e.dataset.key);e.style.order=t})),n("countMovie",0),n("isRestart","yes"),n("isPause","no"),u.innerHTML=0,i.remove()):"new"===r?(i.remove(),n("isPause","no"),n("isRestart","yes"),n("countMovie",0),u.innerHTML=0,c.forEach((e=>e.remove())),new p(s).generateLayout(16)):"save"===r?(c.forEach((e=>{h[e.dataset.key]=e.style.order})),m.push(h),m.push(o("countMovie")),m.push(d.innerHTML,l.innerHTML),n("save",m)):"saved"===r?(c.forEach((e=>{e.style.order=o("save")[0][e.dataset.key]})),n("countMovie",o("save")[1]),n("isPause","no"),u.innerHTML=o("countMovie"),n("loadSaveGame","yes"),i.remove()):"score"===r&&function(){const t=o("winner");t.sort(((e,t)=>e.count-t.count));const n=t.map((t=>e("li","list",`Win for ${t.count} movies and ${t.min}:${t.sec}`,null))),r=e("ol","winList",n),s=e("div","winBoard",[e("h4","board-header","Best 10 winners"),r,e("button","exit-btn","EXIT")]);document.querySelector(".game-container").append(s),document.querySelector(".exit-btn").addEventListener("click",(()=>s.remove()))}()};document.querySelectorAll(".pause-buttons").forEach((e=>e.addEventListener("click",c))),r.addEventListener("click",(()=>{"no"===o("mute")?(r.innerHTML="volume_off",n("mute","yes")):(r.innerHTML="volume_up",n("mute","no"))}))}class c{constructor(){this.min=0,this.sec=0,this.start=()=>{"yes"===o("isRestart")?(this.sec=0,this.min=0,n("isRestart","no")):"yes"===o("loadSaveGame")&&(this.min=Number(o("save")[2]),this.sec=Number(o("save")[3]),n("loadSaveGame","no")),document.querySelector(".min").innerHTML=""+this.min,this.sec<10?document.querySelector(".sec").innerHTML="0"+this.sec:document.querySelector(".sec").innerHTML=this.sec,"no"===o("isPause")&&(59===this.sec?(this.sec=0,this.min+=1):this.sec+=1),setTimeout(this.start,1e3)}}}function u(t){const r=t.changedTouches[0],s=t.target.closest(".chip"),i=s.cloneNode(!0),c=r.clientX-s.getBoundingClientRect().left,u=r.clientY-s.getBoundingClientRect().top,a=document.querySelector(".empty"),l=document.querySelector(".audio"),d=document.querySelectorAll(".chip"),m=document.querySelector(".game-container");let p=null,h=null,y=!1;var v,g;t.preventDefault(),"no"===o("mute")&&l.play(),t.target.closest(".empty")||(document.body.append(i),s.style.opacity=0,h=s,i.classList.add("dragging"),i.ondragstart=()=>!1,v=r.pageX,g=r.pageY,i.style.left=v-c+"px",i.style.top=g-u+"px",document.addEventListener("touchmove",(function(e){const t=e.changedTouches[0];!function(e,t){i.style.left=e-i.offsetWidth/2+"px",i.style.top=t-i.offsetHeight/2+"px"}(t.pageX,t.pageY),y=!0,i.classList.add("nonvisible");const n=document.elementFromPoint(t.clientX,t.clientY);i.classList.remove("nonvisible"),n&&(p=n.closest(".empty"))})),s.addEventListener("touchend",(()=>{if(y){if(!p||1!==Math.abs(h.style.order-p.style.order)&&4!==Math.abs(h.style.order-p.style.order))h.style.opacity=1,i.remove();else{const e=h.style.order,t=p.style.order;n("countMovie",Number(o("countMovie"))+1),document.querySelector(".counter").innerHTML=o("countMovie"),h.style.order=t,p.style.order=e,h.style.opacity=1,i.remove()}i.onmouseup=null,y=!1}else if(1===Math.abs(h.style.order-a.style.order)||4===Math.abs(h.style.order-a.style.order)){const e=h.style.order,t=a.style.order;h.style.order=t,a.style.order=e,n("countMovie",Number(o("countMovie"))+1),document.querySelector(".counter").innerHTML=o("countMovie"),h.style.opacity=1,i.remove()}else h.style.opacity=1,i.remove();let t=0;if(d.forEach((e=>{Number(e.dataset.key)===Number(e.style.order)+1&&(t+=1)})),15===t){const t=e("div","winner",`«Ура! Вы решили головоломку за\n      ${document.querySelector(".min").innerHTML}:${document.querySelector(".sec").innerHTML} и ${o("countMovie")} ходов»`);m.append(t);const r={min:document.querySelector(".min").innerHTML,sec:document.querySelector(".sec").innerHTML,count:o("countMovie")},s=o("winner");s.length<10?(s.push(r),n("winner",s)):(s.sort(((e,t)=>e.count-t.count)),s[s.length-1].count>r.count&&(s.pop(),s.push(r),n("winner",s)))}})))}const a=e("div","timer-container",[e("span","description","Time:"),e("div","timer",[e("span","min"),e("span",null,":"),e("span","sec")])]),l=e("div","counter-container",[e("span","description","Movies:"),e("span","counter","0")]),d=e("button","pause","Pause Game"),m=e("button","pause visible","Resume Game");e("audio","audio",null,document.body,["src","./../assets/audio/audio.wav"]);class p{constructor(e){this.gameType=e,this.chipArr=[],this.chipOrder=[],this.min=0,this.sec=0,this.countMovies=0,this.isPause="no"}init(){return this.header=e("header","game-header",[a,l,d,m]),this.main=e("main","main",[this.header]),this.container=e("div","game-container",null,this.main),document.body.prepend(this.main),n("countMovie",0),n("isPause","no"),n("isRestart","no"),n("mute","no"),(new c).start(),document.querySelector(".counter").innerHTML=o("countMovie"),this}generateLayout(e){const o=Math.floor(150*Math.random());for(let n=0;n<e;n+=1)if(this.chipArr.push(new t(this.gameType.type[n])),0===n)this.chipArr[n].chip.classList.add("empty");else{this.chipArr[n].chip.style.background=`url("./../assets/img/box/${o}.jpg`;const e=(n-1)%4,t=Math.trunc((n-1)/4);this.chipArr[n].chip.style.backgroundPosition=`left ${33.33*e}% top ${33.33*t}%`,window.innerWidth>600?this.chipArr[n].chip.style.backgroundSize="472px":window.innerWidth>342?this.chipArr[n].chip.style.backgroundSize="312px":this.chipArr[n].chip.style.backgroundSize="272px",this.chipArr[n].chip.style.backgroundRepeat="no-repeat"}let s=1;for(;s%2>0;){s=0,this.chipArr.sort((()=>Math.random()-.5));for(let e=0;e<this.chipArr.length;e+=1){for(let t=e+1;t<this.chipArr.length;t+=1)this.chipArr[e].number>this.chipArr[t].number&&0!==this.chipArr[t].number&&(s+=1);0===this.chipArr[e].number&&(s+=Math.trunc(e/4)+1)}}this.chipArr.forEach(((e,t)=>{document.querySelector(".game-container").append(e.chip),e.chip.style.order=t,this.chipOrder.push(e.chip.dataset.key),e.chip.onmousedown=r,e.chip.addEventListener("touchstart",u)})),n("chipOrder",this.chipOrder),d.addEventListener("click",i)}}new p(s).init(4).generateLayout(16)})();